# 通貨変換ツール 仕様書

## 1. 概要

本ツールは、スマートフォンでの利用を想定したWebベースの通貨変換アプリケーションである。基準となる通貨（日本円）の値を電卓で入力し、登録された複数の外貨にリアルタイムで換算・表示する。

レートや通貨リストはユーザーが自由に追加・編集・並び替え可能であり、変更内容はブラウザの `localStorage` に保存され、次回起動時も維持される。

## 2. 主な機能

* **通貨変換**: 選択した基準通貨の値を、登録されている全通貨に一括変換して表示。
* **電卓**: 数値入力と四則演算（`+`, `-`, `*`, `/`）に対応。計算結果をそのまま変換レートに適用可能。
* **通貨管理 (CRUD)**:
    * **追加 (Create)**: 新しい通貨とレートを追加。
    * **表示 (Read)**: 登録済み通貨をタイル形式で一覧表示。
    * **編集 (Update)**: 国名、通貨コード、レートを編集。
    * **削除 (Delete)**: 通貨をリストから削除（基準通貨「日本」を除く）。
* **並べ替え**: ユーザーの任意（ドラッグ＆ドロップ）で通貨タイルの表示順を変更。
* **データ永続化**: 追加・編集・削除・並べ替えを行った通貨データをブラウザの `localStorage` に保存。

## 3. 画面構成

本ツールは主に3つの画面（スクリーン/モーダル）で構成される。

1.  **計算画面 (メイン)**: 通貨一覧と電卓が表示されるメイン画面。
2.  **設定画面**: 全ての通貨設定を一覧で編集するための画面。
3.  **通貨編集モーダル**: 個別の通貨を新規追加または編集するためのポップアップ画面。

---

## 4. 機能詳細

### 4.1. 計算画面

メインとなる画面。通貨の確認と数値入力（計算）を行う。

#### 4.1.1. ヘッダー
* **タイトル**: 通常時は「外貨両替ツール」、並べ替えモード時は「並び替え」と表示。
* **並べ替えボタン (↕️ / 完了)**:
    * タップで「並べ替えモード」のON/OFFを切り替える。
    * 並べ替えモード中は「完了」ボタン（テキスト）に変化する。
* **設定ボタン (⚙️)**:
    * タップで「設定画面」に遷移する。
    * 並べ替えモード中は非表示になる。

#### 4.1.2. 通貨カードエリア
* 登録されている通貨が2列のグリッド形式で表示されるスクロール領域。
* **通貨カード**:
    * **表示項目**:
        * 国名
        * 通貨コード (国名と横並び)
        * 換算結果 (電卓の表示値からリアルタイム換算された値)
        * レート情報 (例: `1円=0.0067 USD`, `1USD=150.00円`)
            * ※「1円=」のレート表示は小数点以下4桁で固定。
    * **操作 (通常モード時)**:
        * **タップ**: タップしたカードを「選択中」（青い枠線）にし、その通貨を基準として電卓の値を入力できるようにする。
        * **ダブルタップ**: 「通貨編集モーダル」を開き、そのカードの情報を編集する。
        * **削除ボタン (`-`)**: カード右上のボタン。タップで確認ダイアログ表示後、通貨を削除する。（基準通貨「日本」には表示されない）
* **追加ボタン (`+`)**:
    * グリッドの最後に表示される。
    * タップで「通貨編集モーダル」を新規追加モードで開く。
    * 並べ替えモード中は非表示（半透明）になり、タップ不可。

#### 4.1.3. 並べ替えモード
* ヘッダーの「↕️」ボタンで開始する。
* 各カード（日本円含む）の左側にドラッグハンドル（`☰`）が表示される。
* カードをドラッグ＆ドロップすることで、リスト内の順序を自由に入れ替えることができる。
* 並べ替えられた順序は `localStorage` に即時保存される。

#### 4.1.4. 電卓
画面下部に固定表示される。

* **ディスプレイ**:
    * 入力中の数値、または計算結果を表示する。
    * ここの値（`currentValue`）が通貨換算の基準値となる。
* **キーパッド**:
    * **数値**: `0`, `1`～`9`, `00`, `000`, `.` (小数点)
    * **演算子**: `+`, `-`, `×` (`*`), `÷` (`/`)
    * **機能**:
        * `C`: 計算状態をすべてリセット（`0` に戻す）。
        * `⌫`: 末尾の1文字を削除。計算結果（`=`）表示直後は `C` と同動作。
        * `=`: 計算を実行する。
* **計算ロジック**:
    * `100 + 200 =` (結果 `300`) の後、続けて `+ 50 =` と入力すると、`300` を引き継いで `350` が計算される。
    * `100 + 200 =` (結果 `300`) の後、`7` などの数字キーを押すと、計算がリセットされて `7` から新しい入力が開始される。

### 4.2. 設定画面

「計算画面」の `⚙️` ボタンから遷移する。

* **ヘッダー**:
    * **← 戻る**: 「計算画面」に戻る（変更は保存されない）。
    * **保存**: 変更内容を `localStorage` に保存し、「計算画面」に戻る。
* **内容**:
    * 登録されている全通貨がリスト形式で表示される。
    * 各通貨の「国名」「通貨コード」「レート」を入力フィールドで直接編集できる。
    * レートは「1円 = ? (外貨)」と「1 (外貨) = ? 円」の2つの欄があり、片方を入力するともう片方が自動計算される。

### 4.3. 通貨編集モーダル

「計算画面」でカードをダブルタップ、または `+` ボタンをタップすると表示される。

* **入力項目**:
    * 国名 (テキスト)
    * 通貨コード (テキスト)
    * レート (数値): 「1円 = ? (外貨)」と「? (外貨) = 1円」の2つの欄があり、片方を入力するともう片方が自動計算される。
* **ボタン**:
    * **キャンセル**: 変更を破棄してモーダルを閉じる。
    * **保存**: 変更を `localStorage` に保存し、モーダルを閉じ、通貨カードエリアを再描画する。

## 5. データ仕様

### 5.1. 保存データ (localStorage)

* **キー**: `currencyConverterData`
* **形式**: JSON文字列
* **内容**:
    * `currencies`: 通貨オブジェクトの配列。並べ替え順もこの配列順で保持される。
    * `nextId`: 次に新規追加する通貨のID。

```json
{
  "currencies": [
    { "id": 1, "name": "日本", "code": "JPY", "rateFromJPY": 1 },
    { "id": 2, "name": "中国", "code": "CNY", "rateFromJPY": 0.04688232536 },
    { "id": 5, "name": "アメリカ", "code": "USD", "rateFromJPY": 0.00666666666 }
  ],
  "nextId": 6
}
